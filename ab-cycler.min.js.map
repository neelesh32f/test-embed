{"version":3,"file":"ab-cycler.min.js","sources":["../src/ab-cycler.js"],"sourcesContent":["// Main plugin class\nclass ABCycler {\n    constructor(config = {}) {\n        this.config = {\n            apiEndpoint: config.apiEndpoint || 'https://ff09-223-185-131-191.ngrok-free.app',\n            interval: config.interval || 3000,\n            animationDuration: config.animationDuration || 300,\n            initDelay: config.initDelay || 1000,\n            ...config\n        };\n        \n        this.variations = null;\n        this.currentVariationIndex = {};\n        \n        console.log(\"Config: \", this.config);\n        // Wait for DOM and other scripts\n        if (document.readyState === 'loading') {\n            document.addEventListener('DOMContentLoaded', () => this.waitForScriptsAndInit());\n        } else {\n            this.waitForScriptsAndInit();\n        }\n    }\n\n    waitForScriptsAndInit() {\n        console.log(\"Waiting for scripts and init...\");\n        setTimeout(async () => {\n            try {\n                if (document.readyState !== 'complete') {\n                    window.addEventListener('load', () => this.init());\n                } else {\n                    await this.init();\n                }\n            } catch (error) {\n                console.error('Error in waitForScriptsAndInit:', error);\n            }\n        }, this.config.initDelay);\n    }\n\n    async init() {\n        console.log(\"Initializing...\");\n        try {\n            const variations = await this.fetchVariations();\n            \n            // Validate variations before assigning\n            if (variations && typeof variations === 'object' && Object.keys(variations).length > 0) {\n                this.variations = variations;\n                console.log(\"Valid variations received:\", this.variations);\n                this.startCycling();\n            } else {\n                console.log('No valid variations available for current page');\n            }\n        } catch (error) {\n            console.error('Failed to initialize ABCycler:', error);\n        }\n    }\n\n    async fetchVariations() {\n        const storeslug = 'planttherapy';\n        console.log(\"Fetching variations...\");\n        try {\n            // if (!window.location.href.includes('/products/')) {\n            //     console.log(\"Not a product page, skipping variations fetch\");\n            //     return null;\n            // }\n\n            const productslug = window.location.href.split('/products/')[1].split('/')[0];\n            console.log(\"Product slug:\", productslug.split('.')[0]);\n            \n            const url = `${this.config.apiEndpoint}/${storeslug}/products/${productslug}`;\n            console.log(\"Fetching from URL:\", url);\n            \n            const response = await fetch(url);\n            \n            if (!response.ok) {\n                console.error(`HTTP error! status: ${response.status}`);\n                return null;\n            }\n            \n            const data = await response.json();\n            \n            // Validate the response data\n            if (!data || typeof data !== 'object' || Object.keys(data).length === 0) {\n                console.log(\"No valid variations in API response\");\n                return null;\n            }\n\n            // Initialize variation indexes for valid data\n            Object.keys(data).forEach(selector => {\n                this.currentVariationIndex[selector] = 0;\n            });\n\n            return data;\n            \n        } catch (error) {\n            console.error('Failed to fetch variations:', error);\n            return null;\n        }\n    }\n\n    startCycling() {\n        if (!this.variations || typeof this.variations !== 'object') {\n            console.log('No variations to cycle through');\n            return;\n        }\n\n        const selectors = Object.keys(this.variations);\n        if (selectors.length === 0) {\n            console.log('No selectors found in variations');\n            return;\n        }\n\n        selectors.forEach(selector => {\n            const variations = this.variations[selector];\n            if (Array.isArray(variations) && variations.length > 0) {\n                this.cycleElement(selector);\n            } else {\n                console.log(`No valid variations for selector: ${selector}`);\n            }\n        });\n    }\n\n    cycleElement(selector) {\n        const element = document.querySelector(selector);\n        if (!element) {\n            console.log(`Element not found for selector: ${selector}`);\n            return;\n        }\n\n        setInterval(() => {\n            const variations = this.variations[selector];\n            // Additional safety check\n            if (!Array.isArray(variations) || variations.length === 0) return;\n\n            const currentIndex = this.currentVariationIndex[selector];\n            const nextIndex = (currentIndex + 1) % variations.length;\n            \n            this.applyVariation(element, variations[currentIndex], variations[nextIndex]);\n            this.currentVariationIndex[selector] = nextIndex;\n        }, this.config.interval);\n    }\n\n    applyVariation(element, currentVariation, nextVariation) {\n        // Add transition class\n        element.classList.add('ab-cycler-transition');\n        \n        // After animation duration, update content and remove transition class\n        setTimeout(() => {\n            this.updateElement(element, nextVariation);\n            element.classList.remove('ab-cycler-transition');\n        }, this.config.animationDuration);\n    }\n\n    updateElement(element, variation) {\n        if (variation.html) {\n            element.innerHTML = variation.html;\n        }\n        if (variation.text) {\n            element.textContent = variation.text;\n        }\n        if (variation.attributes) {\n            Object.entries(variation.attributes).forEach(([attr, value]) => {\n                element.setAttribute(attr, value);\n            });\n        }\n        if (variation.styles) {\n            Object.assign(element.style, variation.styles);\n        }\n    }\n}\n\n// Create a global instance factory\nwindow.createABCycler = function(config) {\n    return new ABCycler(config);\n};"],"names":["ABCycler","constructor","config","this","apiEndpoint","interval","animationDuration","initDelay","variations","currentVariationIndex","console","log","document","readyState","addEventListener","waitForScriptsAndInit","setTimeout","async","window","init","error","fetchVariations","Object","keys","length","startCycling","productslug","location","href","split","url","response","fetch","ok","status","data","json","forEach","selector","selectors","Array","isArray","cycleElement","element","querySelector","setInterval","currentIndex","nextIndex","applyVariation","currentVariation","nextVariation","classList","add","updateElement","remove","variation","html","innerHTML","text","textContent","attributes","entries","attr","value","setAttribute","styles","assign","style","createABCycler"],"mappings":"yBACA,MAAMA,EACFC,WAAAA,CAAYC,EAAS,IACjBC,KAAKD,OAAS,CACVE,YAAaF,EAAOE,aAAe,8CACnCC,SAAUH,EAAOG,UAAY,IAC7BC,kBAAmBJ,EAAOI,mBAAqB,IAC/CC,UAAWL,EAAOK,WAAa,OAC5BL,GAGPC,KAAKK,WAAa,KAClBL,KAAKM,sBAAwB,GAE7BC,QAAQC,IAAI,WAAYR,KAAKD,QAED,YAAxBU,SAASC,WACTD,SAASE,iBAAiB,oBAAoB,IAAMX,KAAKY,0BAEzDZ,KAAKY,uBAEb,CAEAA,qBAAAA,GACIL,QAAQC,IAAI,mCACZK,YAAWC,UACP,IACgC,aAAxBL,SAASC,WACTK,OAAOJ,iBAAiB,QAAQ,IAAMX,KAAKgB,eAErChB,KAAKgB,MAElB,CAAC,MAAOC,GACLV,QAAQU,MAAM,kCAAmCA,EACrD,IACDjB,KAAKD,OAAOK,UACnB,CAEA,UAAMY,GACFT,QAAQC,IAAI,mBACZ,IACI,MAAMH,QAAmBL,KAAKkB,kBAG1Bb,GAAoC,iBAAfA,GAA2Bc,OAAOC,KAAKf,GAAYgB,OAAS,GACjFrB,KAAKK,WAAaA,EAClBE,QAAQC,IAAI,6BAA8BR,KAAKK,YAC/CL,KAAKsB,gBAELf,QAAQC,IAAI,iDAEnB,CAAC,MAAOS,GACLV,QAAQU,MAAM,iCAAkCA,EACpD,CACJ,CAEA,qBAAMC,GAEFX,QAAQC,IAAI,0BACZ,IAMI,MAAMe,EAAcR,OAAOS,SAASC,KAAKC,MAAM,cAAc,GAAGA,MAAM,KAAK,GAC3EnB,QAAQC,IAAI,gBAAiBe,EAAYG,MAAM,KAAK,IAEpD,MAAMC,EAAM,GAAG3B,KAAKD,OAAOE,qCAAqCsB,IAChEhB,QAAQC,IAAI,qBAAsBmB,GAElC,MAAMC,QAAiBC,MAAMF,GAE7B,IAAKC,EAASE,GAEV,OADAvB,QAAQU,MAAM,uBAAuBW,EAASG,UACvC,KAGX,MAAMC,QAAaJ,EAASK,OAG5B,OAAKD,GAAwB,iBAATA,GAAkD,IAA7Bb,OAAOC,KAAKY,GAAMX,QAM3DF,OAAOC,KAAKY,GAAME,SAAQC,IACtBnC,KAAKM,sBAAsB6B,GAAY,CAAC,IAGrCH,IATHzB,QAAQC,IAAI,uCACL,KAUd,CAAC,MAAOS,GAEL,OADAV,QAAQU,MAAM,8BAA+BA,GACtC,IACX,CACJ,CAEAK,YAAAA,GACI,IAAKtB,KAAKK,YAAyC,iBAApBL,KAAKK,WAEhC,YADAE,QAAQC,IAAI,kCAIhB,MAAM4B,EAAYjB,OAAOC,KAAKpB,KAAKK,YACV,IAArB+B,EAAUf,OAKde,EAAUF,SAAQC,IACd,MAAM9B,EAAaL,KAAKK,WAAW8B,GAC/BE,MAAMC,QAAQjC,IAAeA,EAAWgB,OAAS,EACjDrB,KAAKuC,aAAaJ,GAElB5B,QAAQC,IAAI,qCAAqC2B,IACrD,IAVA5B,QAAQC,IAAI,mCAYpB,CAEA+B,YAAAA,CAAaJ,GACT,MAAMK,EAAU/B,SAASgC,cAAcN,GAClCK,EAKLE,aAAY,KACR,MAAMrC,EAAaL,KAAKK,WAAW8B,GAEnC,IAAKE,MAAMC,QAAQjC,IAAqC,IAAtBA,EAAWgB,OAAc,OAE3D,MAAMsB,EAAe3C,KAAKM,sBAAsB6B,GAC1CS,GAAaD,EAAe,GAAKtC,EAAWgB,OAElDrB,KAAK6C,eAAeL,EAASnC,EAAWsC,GAAetC,EAAWuC,IAClE5C,KAAKM,sBAAsB6B,GAAYS,CAAS,GACjD5C,KAAKD,OAAOG,UAdXK,QAAQC,IAAI,mCAAmC2B,IAevD,CAEAU,cAAAA,CAAeL,EAASM,EAAkBC,GAEtCP,EAAQQ,UAAUC,IAAI,wBAGtBpC,YAAW,KACPb,KAAKkD,cAAcV,EAASO,GAC5BP,EAAQQ,UAAUG,OAAO,uBAAuB,GACjDnD,KAAKD,OAAOI,kBACnB,CAEA+C,aAAAA,CAAcV,EAASY,GACfA,EAAUC,OACVb,EAAQc,UAAYF,EAAUC,MAE9BD,EAAUG,OACVf,EAAQgB,YAAcJ,EAAUG,MAEhCH,EAAUK,YACVtC,OAAOuC,QAAQN,EAAUK,YAAYvB,SAAQ,EAAEyB,EAAMC,MACjDpB,EAAQqB,aAAaF,EAAMC,EAAM,IAGrCR,EAAUU,QACV3C,OAAO4C,OAAOvB,EAAQwB,MAAOZ,EAAUU,OAE/C,EAIJ/C,OAAOkD,eAAiB,SAASlE,GAC7B,OAAO,IAAIF,EAASE,EACxB"}
