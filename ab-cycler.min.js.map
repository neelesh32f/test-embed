{"version":3,"file":"ab-cycler.min.js","sources":["../src/ab-cycler.js"],"sourcesContent":["// Main plugin class\nclass ABCycler {\n    constructor(config = {}) {\n        this.config = {\n            apiEndpoint: config.apiEndpoint || 'https://https://ff09-223-185-131-191.ngrok-free.app',\n            interval: config.interval || 3000,\n            animationDuration: config.animationDuration || 300,\n            initDelay: config.initDelay || 1000,\n            ...config\n        };\n        \n        this.variations = null;\n        this.currentVariationIndex = {};\n        \n        console.log(\"Config: \", this.config);\n        // Wait for DOM and other scripts\n        if (document.readyState === 'loading') {\n            document.addEventListener('DOMContentLoaded', () => this.waitForScriptsAndInit());\n        } else {\n            this.waitForScriptsAndInit();\n        }\n    }\n\n    waitForScriptsAndInit() {\n        // Wait for a small delay after load to ensure dynamic content is loaded\n        console.log(\"Waiting for scripts and init...\")\n        setTimeout(async () => {\n            // Additional check for any loading states or dynamic content\n            console.log(\"Calling things..\")\n            if (document.readyState !== 'complete') {\n                window.addEventListener('load', () => this.init());\n            } else {\n                await this.init();\n            }\n        }, this.config.initDelay);\n    }\n\n    async init() {\n        console.log(\"Initializing...\")\n        try {\n            await this.fetchVariations();\n            console.log(\"Variations: \", this.variations);\n            // Only start cycling if we have variations\n            if (this.variations && Object.keys(this.variations).length > 0) {\n                this.startCycling();\n            } else {\n                console.log('No variations available for current page');\n            }\n        } catch (error) {\n            console.error('Failed to initialize ABCycler:', error);\n        }\n    }\n\n    async fetchVariations() {\n        const storeslug = 'planttherapy';\n        console.log(\"Fetching variations...\");\n        try {\n            if (window.location.href.includes('/products/')) {\n                const productslug = window.location.href.split('/products/')[1].split('/')[0];\n                console.log(\"Product slug: \", productslug);\n                const response = await fetch(`${this.config.apiEndpoint}/${storeslug}/products/${productslug}`);\n                \n                if (!response.ok) {\n                    throw new Error(`HTTP error! status: ${response.status}`);\n                }\n                \n                const data = await response.json();\n                \n                // Ensure we have valid variation data\n                if (data && typeof data === 'object' && Object.keys(data).length > 0) {\n                    this.variations = data;\n                    console.log(\"Variations received: \", this.variations);\n                    // Initialize variation indexes\n                    Object.keys(this.variations).forEach(selector => {\n                        this.currentVariationIndex[selector] = 0;\n                    });\n                } else {\n                    console.log(\"No valid variations received from API\");\n                    this.variations = null;\n                }\n            } else {\n                console.log(\"Not a product page, skipping variations fetch\");\n                this.variations = null;\n            }\n        } catch (error) {\n            console.error('Failed to fetch variations:', error);\n            this.variations = null;\n            throw error;\n        }\n    }\n\n    startCycling() {\n        // Safety check\n        if (!this.variations || typeof this.variations !== 'object') {\n            console.log('No variations to cycle through');\n            return;\n        }\n\n        Object.keys(this.variations).forEach(selector => {\n            const variations = this.variations[selector];\n            // Only cycle if we have valid variations for this selector\n            if (Array.isArray(variations) && variations.length > 0) {\n                this.cycleElement(selector);\n            } else {\n                console.log(`No valid variations for selector: ${selector}`);\n            }\n        });\n    }\n\n    cycleElement(selector) {\n        const element = document.querySelector(selector);\n        if (!element) {\n            console.log(`Element not found for selector: ${selector}`);\n            return;\n        }\n\n        setInterval(() => {\n            const variations = this.variations[selector];\n            // Additional safety check\n            if (!Array.isArray(variations) || variations.length === 0) return;\n\n            const currentIndex = this.currentVariationIndex[selector];\n            const nextIndex = (currentIndex + 1) % variations.length;\n            \n            this.applyVariation(element, variations[currentIndex], variations[nextIndex]);\n            this.currentVariationIndex[selector] = nextIndex;\n        }, this.config.interval);\n    }\n\n    applyVariation(element, currentVariation, nextVariation) {\n        // Add transition class\n        element.classList.add('ab-cycler-transition');\n        \n        // After animation duration, update content and remove transition class\n        setTimeout(() => {\n            this.updateElement(element, nextVariation);\n            element.classList.remove('ab-cycler-transition');\n        }, this.config.animationDuration);\n    }\n\n    updateElement(element, variation) {\n        if (variation.html) {\n            element.innerHTML = variation.html;\n        }\n        if (variation.text) {\n            element.textContent = variation.text;\n        }\n        if (variation.attributes) {\n            Object.entries(variation.attributes).forEach(([attr, value]) => {\n                element.setAttribute(attr, value);\n            });\n        }\n        if (variation.styles) {\n            Object.assign(element.style, variation.styles);\n        }\n    }\n}\n\n// Create a global instance factory\nwindow.createABCycler = function(config) {\n    return new ABCycler(config);\n};"],"names":["ABCycler","constructor","config","this","apiEndpoint","interval","animationDuration","initDelay","variations","currentVariationIndex","console","log","document","readyState","addEventListener","waitForScriptsAndInit","setTimeout","async","window","init","fetchVariations","Object","keys","length","startCycling","error","location","href","includes","productslug","split","response","fetch","ok","Error","status","data","json","forEach","selector","Array","isArray","cycleElement","element","querySelector","setInterval","currentIndex","nextIndex","applyVariation","currentVariation","nextVariation","classList","add","updateElement","remove","variation","html","innerHTML","text","textContent","attributes","entries","attr","value","setAttribute","styles","assign","style","createABCycler"],"mappings":"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"}